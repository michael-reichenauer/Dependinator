#!/bin/bash

# Function to update packages in a given project
update_project_packages() {
    local project_path="$1"
    echo "Updating packages for project: $project_path"

    # List outdated packages and update each
    dotnet list "$project_path" package --outdated --include-transitive | \
    grep '>' | \
    awk '{print $2 " " $4}' | \
    while IFS= read -r line; do
        local package_name=$(echo "$line" | awk '{print $1}')
        local package_version=$(echo "$line" | awk '{print $2}')
        echo "Updating $package_name to version $package_version"
        dotnet add "$project_path" package "$package_name" --version "$package_version"
    done
}


# Find all .csproj files and update their packages
find . -name '*.csproj' ! -path '*/obj/*' | \
while IFS= read -r project; do
    update_project_packages "$project"
done