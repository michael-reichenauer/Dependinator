#!/bin/bash
set -euo pipefail

project="./Dependinator.Wasm/Dependinator.Wasm.csproj"
publish_dir="./Dependinator.Wasm/publish"
wwwroot_dir="$publish_dir/wwwroot"
config_dir="./Dependinator.Wasm"
port="${PORT:-5000}"
host="${HOST:-127.0.0.1}"

rm -rf "$publish_dir"
dotnet publish "$project" -c Release -o "$publish_dir"

if command -v swa >/dev/null 2>&1; then
    swa start "$wwwroot_dir" --port "$port" --host "$host" --swa-config-location "$config_dir"
else
    npx --yes @azure/static-web-apps-cli start "$wwwroot_dir" --port "$port" --host "$host" --swa-config-location "$config_dir"
fi
